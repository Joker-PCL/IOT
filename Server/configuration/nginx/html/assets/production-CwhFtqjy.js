import{J as X,Q,r as i,O as H,z as U,j as e,N as W,_ as M,C as Y,G as z,T as P,R as J,u as $,B as R,f as I,n as T,S as C,b as G,P as q,M as K,c as F,m as B,l as V,I as Z,a as ee,D as te,o as se,H as ne}from"./index-DFRRmdgx.js";import{C as oe}from"./config-global-DQeLXOlG.js";import{S as D,C as ie}from"./Card-DeHUnrhc.js";import{R as N}from"./react-svg.esm-k7b-QD0P.js";import{P as re,b as ae}from"./main-BLXQ8eMX.js";import{T as _,a as p,b as le,c as ce,d as de,e as ue,f as he,P as pe,g as xe}from"./TableSortLabel-CIQdbAUw.js";import{D as ge,g as me,a as fe,b as je,c as be}from"./DialogContent-Cuzci1P9.js";import{O as Ce}from"./Select-D5j-WpuF.js";import{L as Pe}from"./loading_page-CWAaSiNY.js";import{G as O}from"./Grid-CNG59LoI.js";import{S as A}from"./Stack-fyjKT1yZ.js";import"./KeyboardArrowRight-DiB5mZOT.js";function ve(t){return X("MuiDialogContentText",t)}Q("MuiDialogContentText",["root"]);const ye=["children","className"],we=t=>{const{classes:s}=t,r=z({root:["root"]},ve,s);return M({},s,r)},Se=W(P,{shouldForwardProp:t=>J(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),Te=i.forwardRef(function(s,o){const r=H({props:s,name:"MuiDialogContentText"}),{className:c}=r,a=U(r,ye),n=we(a);return e.jsx(Se,M({component:"p",variant:"body1",color:"text.secondary",ref:o,ownerState:a,className:Y(n.root,c)},r,{classes:n}))}),De=["className","id"],Re=t=>{const{classes:s}=t;return z({root:["root"]},me,s)},_e=W(P,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,s)=>s.root})({padding:"16px 24px",flex:"0 0 auto"}),ke=i.forwardRef(function(s,o){const r=H({props:s,name:"MuiDialogTitle"}),{className:c,id:a}=r,n=U(r,De),d=r,x=Re(d),{titleId:f=a}=i.useContext(ge);return e.jsx(_e,M({component:"h2",className:Y(x.root,c),ownerState:d,ref:o,variant:"h6",id:a??f},n))});function Ie({row:t,selected:s,eventsRows:o,onEventsRows:r,onSelectRow:c}){const a=$(),[n,d]=i.useState(null),[x,f]=i.useState("paper"),[j,b]=i.useState(!1),v=i.useCallback(u=>{d(u.currentTarget)},[]),l=i.useCallback(()=>{d(null)},[]),g=u=>()=>{b(!0),f(u)},y=()=>{b(!1)},h=u=>()=>{const{machine_name_en:k,start_product:E,finish_product:S}=u;k&&E&&S&&(console.log("Open Detail:",u),a("/Details",{state:u}))},m=u=>{D.fire({title:"ยืนยันการลบรายการ",text:`ชื่อยา: ${u.product_name} เลขที่ผลิต: ${u.lot_number}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ยืนยันการลบ !",cancelButtonText:"ยกเลิก"}).then(k=>{k.isConfirmed&&(async()=>{try{const S=await re(u);r(!o),D.fire({icon:"success",title:"ดำเนินการเรียบร้อยแล้ว",text:"บันทึกรายการผลิตเรียบร้อยแล้ว",showConfirmButton:!1,timer:2e3})}catch(S){console.error("Error fetching data:",S),D.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!, ลองไหม่อีกครั้ง",showCancelButton:!0,cancelButtonText:"ปิด"})}})()})},w=i.useRef(null);return i.useEffect(()=>{if(j){const{current:u}=w;u!==null&&u.focus()}},[j]),e.jsxs(e.Fragment,{children:[e.jsxs(_,{hover:!0,selected:s,style:{verticalAlign:"middle"},children:[e.jsx(p,{component:"th",scope:"row",children:e.jsxs(R,{gap:1,display:"flex",alignItems:"center",children:[e.jsx(N,{src:"/assets/icons/iconify/overtime.svg",style:{width:"40px",height:"40px"}}),I(t.timestamp)]})}),e.jsx(p,{children:t.lot_number}),e.jsx(p,{children:t.product_name}),e.jsx(p,{children:t.batch_size?t.batch_size.toLocaleString():"X,XXX"}),e.jsx(p,{children:t.machine_name_en}),e.jsx(p,{children:I(t.start_product,"DD/MM/YYYY, HH:mm")}),e.jsx(p,{children:I(t.finish_product,"DD/MM/YYYY, HH:mm")}),e.jsx(p,{align:"center",children:e.jsx(T,{onClick:g("paper"),disabled:!t.notes,children:e.jsx(N,{src:t.notes?"/assets/icons/iconify/note.svg":"/assets/icons/iconify/empty-note.svg",style:{width:"30px",height:"30px"}})})}),e.jsx(p,{align:"center",children:e.jsx(T,{onClick:h(t),children:e.jsx(N,{src:"/assets/icons/iconify/info.svg",style:{width:"30px",height:"30px"}})})}),e.jsx(p,{align:"center",children:e.jsx(T,{onClick:v,children:e.jsx(C,{src:"/assets/icons/iconify/menu.svg",width:"25px",height:"25px"})})})]}),e.jsxs(fe,{fullWidth:!0,maxWidth:"sm",open:j,onClose:y,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[e.jsx(ke,{id:"scroll-dialog-title",children:"รายละเอียดเพิ่มเติม"}),e.jsx(je,{dividers:x==="paper",sx:{minHeight:250},children:e.jsx(Te,{id:"scroll-dialog-description",ref:w,tabIndex:-1,children:t.notes?t.notes:"# ไม่มีหมายเหตุ"})}),e.jsx(be,{children:e.jsx(G,{onClick:y,variant:"contained",color:"error",children:"ปิด"})})]}),e.jsx(q,{open:!!n,anchorEl:n,onClose:l,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(K,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${B.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${B.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(F,{onClick:()=>{l(),t&&a("/production/form",{state:{row:t}})},children:[e.jsx(C,{src:"/assets/icons/iconify/edit.svg",width:"20px",height:"20px"}),"แก้ไข"]}),e.jsxs(F,{onClick:()=>{l(),m(t)},sx:{color:"error.main"},children:[e.jsx(C,{src:"/assets/icons/iconify/delete.svg",width:"20px",height:"20px"}),"ลบ"]})]})})]})}function Ne({searchQuery:t,...s}){return e.jsx(_,{...s,children:e.jsx(p,{align:"center",colSpan:7,children:e.jsxs(R,{sx:{py:15,textAlign:"center"},children:[e.jsx(P,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Oe={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Me(t,s,o){return t?Math.max(0,(1+t)*s-o):0}function L(t,s,o){return s[o]<t[o]?-1:s[o]>t[o]?1:0}function Ee(t,s){return t==="desc"?(o,r)=>-L(o,r,s):(o,r)=>L(o,r,s)}function Fe({inputData:t,comparator:s,filterName:o,order:r}){const c=t.map((a,n)=>[a,n]);return c.sort((a,n)=>{const d=s(a[0],n[0]);return d!==0?d:a[1]-n[1]}),t=c.map(a=>a[0]),o&&(t=t.filter(a=>Object.values(a).some(n=>String(n).toLowerCase().includes(o.toLowerCase())))),t}function Be({order:t,onSort:s,orderBy:o,rowCount:r,headLabel:c,numSelected:a}){return e.jsx(le,{children:e.jsx(_,{style:{verticalAlign:"top"},children:c.map(n=>e.jsx(p,{align:n.align||"left",sortDirection:o===n.id?t:!1,sx:{width:n.width,minWidth:n.minWidth},children:e.jsxs(ce,{hideSortIcon:!0,active:o===n.id,direction:o===n.id?t:"asc",onClick:()=>s(n.id),children:[n.label,o===n.id?e.jsx(R,{sx:{...Oe},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},n.id))})})}function Ae({numSelected:t,filterName:s,onFilterName:o}){return e.jsxs(V,{sx:{height:96,display:"flex",justifyContent:"space-between",p:r=>r.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(Ce,{fullWidth:!0,value:s,onChange:o,placeholder:"ค้นหาข้อมูลในตาราง...",startAdornment:e.jsx(Z,{position:"start",children:e.jsx(C,{src:"/assets/icons/iconify/filter.svg",width:"20px",height:"20px",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),e.jsx(ee,{title:"Filter list",children:e.jsx(T,{children:e.jsx(C,{src:"/assets/icons/iconify/filter.svg",width:"20px",height:"20px",sx:{color:"text.disabled"}})})})]})}function Le({emptyRows:t,height:s,sx:o,...r}){return t?e.jsx(_,{sx:{...s&&{height:s*t},...o},...r,children:e.jsx(p,{colSpan:9})}):null}function He(){const t=$(),s=Ue(),[o,r]=i.useState(!0),[c,a]=i.useState(!1),[n,d]=i.useState([]),[x,f]=i.useState("");i.useEffect(()=>{(async()=>{try{const g=await ae();r(!1),d(g),console.log(g)}catch(g){g.status===401||g.status===403?t("/login"):(D.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",g))}})()},[c,t]);const j=()=>()=>{t("/production/form")},b=Fe({inputData:n,comparator:Ee(s.order,s.orderBy),filterName:x,order:"asc"}),v=!b.length&&!!x;return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{isShowing:o}),e.jsxs(te,{children:[e.jsxs(R,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(P,{variant:"h4",flexGrow:1,children:"รายการผลิต"}),e.jsx(G,{variant:"contained",color:"inherit",onClick:j(),startIcon:e.jsx(C,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการ"})]}),e.jsxs(ie,{children:[e.jsx(Ae,{numSelected:s.selected.length,filterName:x,onFilterName:l=>{f(l.target.value),s.onResetPage()}}),e.jsx(se,{children:e.jsx(de,{sx:{overflow:"unset"},children:e.jsxs(ue,{sx:{minWidth:1100},children:[e.jsx(Be,{order:s.order,orderBy:s.orderBy,rowCount:n.length,numSelected:s.selected.length,onSort:s.onSort,headLabel:[{id:"timestamp",label:"Timestamp"},{id:"lot_number",label:"เลขที่ผลิต"},{id:"product_names",label:"รายการผลิต"},{id:"batch_size",label:"ขนาดผลิต"},{id:"machine",label:"เครื่องจักร"},{id:"start_product",label:"วันที่เริ่มการผลิต"},{id:"finish_product",label:"วันที่จบการผลิต"},{id:"note",label:"Note",align:"center"},{id:"info",label:"ข้อมูล",align:"center"},{id:"edit",label:"แก้ไข",align:"center"}]}),e.jsxs(he,{children:[b.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(l=>e.jsx(Ie,{row:l,eventsRows:c,onEventsRows:a,selected:s.selected.includes(l.production_id),onSelectRow:()=>s.onSelectRow(l.production_id)},l.production_id)),e.jsx(Le,{height:68,emptyRows:Me(s.page,s.rowsPerPage,n.length)}),v&&e.jsx(Ne,{searchQuery:x})]})]})})}),e.jsxs(O,{container:!0,spacing:2,alignItems:"center",justifyContent:"space-between",sx:{mt:2,pb:2,px:2.5,backgroundColor:"#f9f9f9",flexWrap:{xs:"wrap",md:"nowrap"}},children:[e.jsx(O,{item:!0,xs:12,md:"auto",children:e.jsx(A,{direction:"row",justifyContent:"center",alignItems:"center",children:e.jsx(pe,{count:Math.ceil(n.length/s.rowsPerPage),page:s.page+1,onChange:(l,g)=>s.onChangePage(l,g-1),color:"primary",shape:"rounded",siblingCount:1,boundaryCount:1})})}),e.jsx(O,{item:!0,xs:12,md:"auto",children:e.jsx(A,{direction:"row",justifyContent:"center",alignItems:"center",children:e.jsx(xe,{component:"div",page:s.page,count:n.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})})})]})]})]})]})}function Ue(){const[t,s]=i.useState(0),[o,r]=i.useState("name"),[c,a]=i.useState(5),[n,d]=i.useState([]),[x,f]=i.useState("asc"),j=i.useCallback(h=>{f(o===h&&x==="asc"?"desc":"asc"),r(h)},[x,o]),b=i.useCallback((h,m)=>{if(h){d(m);return}d([])},[]),v=i.useCallback(h=>{const m=n.includes(h)?n.filter(w=>w!==h):[...n,h];d(m)},[n]),l=i.useCallback(()=>{s(0)},[]),g=i.useCallback((h,m)=>{s(m)},[]),y=i.useCallback(h=>{a(parseInt(h.target.value,10)),l()},[l]);return{page:t,order:x,onSort:j,orderBy:o,selected:n,rowsPerPage:c,onSelectRow:v,onResetPage:l,onChangePage:g,onSelectAllRows:b,onChangeRowsPerPage:y}}function et(){return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs("title",{children:[" ",`รายการผลิต - ${oe.appName}`]})}),e.jsx(He,{})]})}export{et as default};
