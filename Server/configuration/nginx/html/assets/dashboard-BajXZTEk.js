import{u as P,r as l,j as e,B as i,A,T as o,f as y,S as u,L as B,a as _,b as D,v as E,P as G,M as H,c as N,m as I,I as R,d as q,D as V,H as J}from"./index-APk_ercu.js";import{C as K}from"./config-global-DGEDRhMa.js";import{S as L}from"./sweetalert2.esm.all-B0Dix5B2.js";import{C as Q}from"./Card-D5w6UqlM.js";import{A as U,a as Y}from"./Autocomplete-DX3f3lJ8.js";import{T as Z}from"./TextField-1PT9StYO.js";import{L as ee}from"./loading_page-CFHeN8ug.js";import{D as ne}from"./main-DE3NBUeJ.js";import{G as S}from"./Grid2-D6rnqpTF.js";import"./link_api-Ri0DxbcY.js";function te({sx:a,post:n,...m}){const t=P(),[h,x]=l.useState(0),[f,g]=l.useState("");l.useEffect(()=>{const s=new Date(n.start_product),W=new Date().getTime()-s.getTime(),$=Math.floor(W/1e3),w=Math.floor($/60),C=Math.floor(w/60),X=w%60;g(`${C>=0?C:"XX"} ชั่วโมง ${X>=0?X:"XX"} นาที`);const z=((n==null?void 0:n.mode_pcs_count)>(n==null?void 0:n.mode_gram_count)?n.mode_pcs_count:n.mode_gram_count)/n.batch_size*100;x(z)},[n]);const p=s=>()=>{s.lot_number?t("/details",{state:s}):L.fire({icon:"question",title:`เครื่อง ${s.machine}`,text:"ไม่พบข้อมูลการผลิต, ยังไม่มีข้อมูลการผลิตในวันนี้!",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"+ เพิ่มข้อมูล"}).then(v=>{v.isConfirmed&&t("/production/form",{state:{row:{machine:s.machine}}})})},b=s=>()=>{t("/machine-setting/form",{state:{post:{device_id:s.device_id,serial_number_1:s.serial_number_1,serial_number_2:s.serial_number_2,machine:s.machine,machine_id:s.machine_id,machine_img:s.machine_img,group_name:s.group_name}}})},r=s=>()=>{t("/performance",{state:s})},d=e.jsx(i,{component:"img",alt:n.machine,src:n.machine_img?n.machine_img:"/assets/images/machine/default.png",sx:{top:0,width:1,height:1,objectFit:"cover",position:"absolute"}}),c=e.jsx(u,{width:88,height:36,src:"/assets/icons/shape-avatar.svg",sx:{left:0,zIndex:9,bottom:-16,position:"absolute",color:"background.paper"}}),j=e.jsx(A,{alt:n.machine,src:n.group_img?n.group_img:"/assets/images/machine/default.png",sx:{left:24,zIndex:9,bottom:-24,position:"absolute"}}),F=e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`เลขที่ผลิต ${n.lot_number?n.lot_number:"XXXXXX"}`}),e.jsx(o,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`ชื่อยา ${n.product_name?n.product_name:"XXXXXX"}`}),e.jsxs(o,{variant:"body2",component:"div",sx:{mb:1,color:"grey"},children:[`เริ่มการผลิต ${n.start_product?y(n.start_product):"XXXXXX"}`,e.jsx("br",{}),`จบการผลิต ${n.finish_product?y(n.finish_product):"XXXXXX"}`]})]}),T=e.jsxs(i,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",children:[e.jsx(o,{variant:"body1",component:"div",sx:{fontSize:"18px",color:"cornflowerblue",textDecoration:"underline",fontWeight:"400"},children:n.machine}),e.jsxs(i,{gap:.1,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{width:15,height:15,src:"/assets/icons/iconify/si-clock-duotone.svg",sx:{mb:.3,mr:.3,color:"#40BC14"}}),e.jsx(o,{variant:"body2",component:"div",sx:{color:"text.disabled"},children:f})]})]}),k=e.jsxs(i,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",children:[e.jsx(o,{variant:"caption",component:"div",sx:{color:"text.disabled"},children:n.connection?y(n.connection):"XXXXXX"}),e.jsxs(i,{gap:.1,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{width:15,height:15,src:n.device_status===void 0?"/assets/icons/iconify/line-md--downloading-loop.svg":"/assets/icons/iconify/ic-round-lens.svg",sx:{mb:.1,color:n.device_status===void 0?"text.disabled":n.device_status?"#40BC14":"#E4080A"}}),e.jsx(o,{variant:"body2",component:"div",sx:{color:"text.disabled"},children:n.device_status===void 0?"Loading...":n.device_status?"กำลังทำงาน":"หยุดทำงาน"})]})]}),M=e.jsxs(e.Fragment,{children:[e.jsxs(i,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",sx:{mt:1,color:"text.disabled"},children:[e.jsx(o,{variant:"body2",sx:{mr:.5},children:"การผลิต"}),e.jsxs(o,{variant:"body2",children:[(n==null?void 0:n.mode_pcs_count)>(n==null?void 0:n.mode_gram_count)?n.mode_pcs_count.toLocaleString():n.mode_gram_count.toLocaleString(),"/",n.batch_size>0?n.batch_size.toLocaleString():"X,XXX"]})]}),e.jsx(i,{sx:{width:"100%"},children:e.jsx(B,{variant:"determinate",color:"success",sx:{height:15,borderRadius:1},value:h})})]});i,i,[{number:n.mode_gram_count,unit:"Gram",color:"primary.main",icon:"skill-icons:unity-light"},{number:n.mode_pcs_count,unit:"Pcs",color:"secondary.main",icon:"material-symbols:scale"}].map((s,v)=>e.jsxs(i,{display:"flex",children:[e.jsx(o,{variant:"body1",sx:{mr:.5,color:s.color,fontWeight:"500"},children:s.unit}),e.jsx(o,{variant:"body1",sx:{fontWeight:"500"},children:s.number.toLocaleString()})]},v));const O=e.jsx(e.Fragment,{children:e.jsxs(i,{gap:1.5,display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",sx:{mt:2},children:[e.jsxs(i,{gap:1,display:"flex",flexWrap:"wrap",alignItems:"center",children:[e.jsx(_,{title:"ตั้งค่าเครื่องจักร",children:e.jsx(u,{onClick:b(n),width:30,height:30,src:"/assets/icons/iconify/solar--settings-bold-duotone.svg",sx:{cursor:"pointer",color:"text.disabled"}})}),e.jsx(_,{title:"ข้อมูลการผลิต",children:e.jsx(u,{onClick:p(n),width:30,height:30,src:"/assets/icons/iconify/fluent--clipboard-text-edit-48-filled.svg",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}})}),e.jsx(_,{title:"ประสิทธิภาพการผลิต",children:e.jsx(u,{onClick:r(n),width:30,height:30,src:"/assets/icons/navbar/ic-performance.svg",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}})})]}),e.jsxs(i,{display:"flex",children:[e.jsx(o,{variant:"body1",sx:{mr:.5,color:"primary.main",fontWeight:"500"},children:"SPEED"}),e.jsx(o,{variant:"body1",sx:{fontWeight:"500",color:"#868686"},children:"XX.X/XX"})]})]})});return e.jsxs(Q,{sx:a,...m,children:[e.jsxs(i,{sx:s=>({position:"relative",pt:"calc(100% * 3 / 4)"}),children:[c,j,d]}),e.jsxs(i,{sx:s=>({p:s.spacing(6,3,3,3)}),children:[F,T,k,M,O]})]})}function se({options:a,filterBy:n,onFilter:m,sx:t,...h}){var b;const[x,f]=l.useState(null),g=l.useCallback(r=>{f(r.currentTarget)},[]),p=l.useCallback(()=>{f(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(D,{disableRipple:!0,color:"inherit",onClick:g,endIcon:e.jsx(u,{width:30,height:30,src:x?"/assets/icons/iconify/eva--chevron-up-fill.svg":"/assets/icons/iconify/eva--chevron-down-fill.svg",sx:{ml:-1}}),sx:{bgcolor:r=>E(r.vars.palette.grey["500Channel"],.08),...t},...h,children:(b=a.find(r=>r.value===n))==null?void 0:b.label}),e.jsx(G,{open:!!x,anchorEl:x,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(H,{disablePadding:!0,sx:{p:.5,gap:.5,width:160,display:"flex",flexDirection:"column",[`& .${I.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${I.selected}`]:{bgcolor:"action.selected"}}},children:a.map(r=>e.jsx(N,{selected:r.value===n,onClick:()=>{m(r.value),p()},children:r.label},r.value))})})]})}function ie({posts:a,onSearch:n,sx:m}){return e.jsx(U,{sx:{width:280},autoHighlight:!0,freeSolo:!0,onInputChange:n,popupIcon:null,slotProps:{paper:{sx:{width:320,[`& .${Y.option}`]:{typography:"body2"},...m}}},options:a,getOptionLabel:t=>typeof t=="string"?t:t.machine,isOptionEqualToValue:(t,h)=>t.machine===h.machine,renderInput:t=>e.jsx(Z,{...t,placeholder:"ค้นหาเครื่องจักร...",InputProps:{...t.InputProps,startAdornment:e.jsx(R,{position:"start",children:e.jsx(q,{children:e.jsx("path",{fill:"currentColor",d:"m20.71 19.29l-3.4-3.39A7.92 7.92 0 0 0 19 11a8 8 0 1 0-8 8a7.92 7.92 0 0 0 4.9-1.69l3.39 3.4a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42M5 11a6 6 0 1 1 6 6a6 6 0 0 1-6-6"})})})}})})}function ae({inputData:a,filterName:n}){return a=a.map((t,h)=>[t,h]).map(t=>t[0]),n&&(a=a.filter(t=>t.machine.toLowerCase().indexOf(n.toLowerCase())!==-1||t.group_name.toLowerCase().indexOf(n.toLowerCase())!==-1)),a}function re(){const a=P(),[n,m]=l.useState(""),[t,h]=l.useState([]),[x,f]=l.useState(!0),[g,p]=l.useState([]);l.useEffect(()=>{(async()=>{try{const c=await ne();f(!1),p(c),console.log(c),h([...new Set([...c.map(j=>j.group_name)])])}catch(c){c.status===401||c.status===403?a("/login"):(L.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",c))}})()},[x,a]);const b=ae({inputData:g,filterName:n}),r=l.useCallback(d=>{m(d)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{isShowing:x}),e.jsxs(V,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(o,{variant:"h4",flexGrow:1,children:"Dashboard"}),e.jsx(D,{variant:"contained",color:"inherit",onClick:()=>{a("/machine-setting/form")},startIcon:e.jsx(u,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการเครื่องจักร"})]}),e.jsxs(i,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mb:5},children:[e.jsx(ie,{posts:g,onSearch:(d,c)=>{m(c)}}),e.jsx(se,{filterBy:n,onFilter:r,options:[{value:"",label:"Groups..."},...t.map(d=>({value:d,label:d}))]})]}),e.jsx(S,{container:!0,spacing:3,children:x?"":(n?b:g).map((d,c)=>e.jsx(S,{xs:12,sm:6,md:4,xl:3,children:e.jsx(te,{post:d})},d.machine+c))})]})]})}function je(){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[" ",`Dashboard - ${K.appName}`]})}),e.jsx(re,{})]})}export{je as default};
