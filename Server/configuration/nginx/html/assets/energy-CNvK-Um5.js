import{r as p,Q as V,J as K,z as H,ae as tt,_ as j,O as Y,j as o,N as q,C as J,X as O,G as Q,Y as et,h as ot,B as W,T as E,a as st,n as rt,u as at,s as it,q as nt,H as lt}from"./index-DFRRmdgx.js";import{C as ct}from"./config-global-DQeLXOlG.js";import{C as S,S as dt}from"./Card-DeHUnrhc.js";import{u as N,C as ut,a as pt}from"./chart-legends-BSKEdJyU.js";import{a as G}from"./colorManipulator-kcRzv3LA.js";import{E as gt,W as xt}from"./main-BLXQ8eMX.js";import{R as mt}from"./react-svg.esm-k7b-QD0P.js";import{C as ft}from"./CardContent-BY8C5yS_.js";import{T as ht,a as I}from"./Tabs-CZAshcpO.js";import{G as $}from"./Grid-CNG59LoI.js";import"./Stack-fyjKT1yZ.js";import"./KeyboardArrowRight-DiB5mZOT.js";function bt(t){return p.Children.toArray(t).filter(e=>p.isValidElement(e))}function vt(t){return K("MuiToggleButton",t)}const R=V("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),X=p.createContext({}),Z=p.createContext(void 0);function yt(t,e){return e===void 0||t===void 0?!1:Array.isArray(e)?e.indexOf(t)>=0:t===e}const Bt=["value"],Ct=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],$t=t=>{const{classes:e,fullWidth:a,selected:r,disabled:u,size:l,color:f}=t,x={root:["root",r&&"selected",u&&"disabled",a&&"fullWidth",`size${O(l)}`,f]};return Q(x,vt,e)},jt=q(et,{name:"MuiToggleButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e[`size${O(a.size)}`]]}})(({theme:t,ownerState:e})=>{let a=e.color==="standard"?t.palette.text.primary:t.palette[e.color].main,r;return t.vars&&(a=e.color==="standard"?t.vars.palette.text.primary:t.vars.palette[e.color].main,r=e.color==="standard"?t.vars.palette.text.primaryChannel:t.vars.palette[e.color].mainChannel),j({},t.typography.button,{borderRadius:(t.vars||t).shape.borderRadius,padding:11,border:`1px solid ${(t.vars||t).palette.divider}`,color:(t.vars||t).palette.action.active},e.fullWidth&&{width:"100%"},{[`&.${R.disabled}`]:{color:(t.vars||t).palette.action.disabled,border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:G(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${R.selected}`]:{color:a,backgroundColor:t.vars?`rgba(${r} / ${t.vars.palette.action.selectedOpacity})`:G(a,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${r} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:G(a,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${r} / ${t.vars.palette.action.selectedOpacity})`:G(a,t.palette.action.selectedOpacity)}}}},e.size==="small"&&{padding:7,fontSize:t.typography.pxToRem(13)},e.size==="large"&&{padding:15,fontSize:t.typography.pxToRem(15)})}),F=p.forwardRef(function(e,a){const r=p.useContext(X),{value:u}=r,l=H(r,Bt),f=p.useContext(Z),x=tt(j({},l,{selected:yt(e.value,u)}),e),v=Y({props:x,name:"MuiToggleButton"}),{children:n,className:h,color:T="standard",disabled:d=!1,disableFocusRipple:i=!1,fullWidth:s=!1,onChange:b,onClick:g,selected:C,size:z="medium",value:D}=v,w=H(v,Ct),L=j({},v,{color:T,disabled:d,disableFocusRipple:i,fullWidth:s,size:z}),k=$t(L),y=B=>{g&&(g(B,D),B.defaultPrevented)||b&&b(B,D)},m=f||"";return o.jsx(jt,j({className:J(l.className,k.root,h,m),disabled:d,focusRipple:!i,ref:a,onClick:y,onChange:b,value:D,ownerState:L,"aria-pressed":C},w,{children:n}))});function Tt(t){return K("MuiToggleButtonGroup",t)}const c=V("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Rt=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],Dt=t=>{const{classes:e,orientation:a,fullWidth:r,disabled:u}=t,l={root:["root",a==="vertical"&&"vertical",r&&"fullWidth"],grouped:["grouped",`grouped${O(a)}`,u&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return Q(l,Tt,e)},Wt=q("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[{[`& .${c.grouped}`]:e.grouped},{[`& .${c.grouped}`]:e[`grouped${O(a.orientation)}`]},{[`& .${c.firstButton}`]:e.firstButton},{[`& .${c.lastButton}`]:e.lastButton},{[`& .${c.middleButton}`]:e.middleButton},e.root,a.orientation==="vertical"&&e.vertical,a.fullWidth&&e.fullWidth]}})(({ownerState:t,theme:e})=>j({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},t.orientation==="vertical"&&{flexDirection:"column"},t.fullWidth&&{width:"100%"},{[`& .${c.grouped}`]:j({},t.orientation==="horizontal"?{[`&.${c.selected} + .${c.grouped}.${c.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${c.selected} + .${c.grouped}.${c.selected}`]:{borderTop:0,marginTop:0}})},t.orientation==="horizontal"?{[`& .${c.firstButton},& .${c.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${c.lastButton},& .${c.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${c.firstButton},& .${c.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${c.lastButton},& .${c.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},t.orientation==="horizontal"?{[`& .${c.lastButton}.${R.disabled},& .${c.middleButton}.${R.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${c.lastButton}.${R.disabled},& .${c.middleButton}.${R.disabled}`]:{borderTop:"1px solid transparent"}})),zt=p.forwardRef(function(e,a){const r=Y({props:e,name:"MuiToggleButtonGroup"}),{children:u,className:l,color:f="standard",disabled:x=!1,exclusive:v=!1,fullWidth:n=!1,onChange:h,orientation:T="horizontal",size:d="medium",value:i}=r,s=H(r,Rt),b=j({},r,{disabled:x,fullWidth:n,orientation:T,size:d}),g=Dt(b),C=p.useCallback((y,m)=>{if(!h)return;const B=i&&i.indexOf(m);let _;i&&B>=0?(_=i.slice(),_.splice(B,1)):_=i?i.concat(m):[m],h(y,_)},[h,i]),z=p.useCallback((y,m)=>{h&&h(y,i===m?null:m)},[h,i]),D=p.useMemo(()=>({className:g.grouped,onChange:v?z:C,value:i,size:d,fullWidth:n,color:f,disabled:x}),[g.grouped,v,z,C,i,d,n,f,x]),w=bt(u),L=w.length,k=y=>{const m=y===0,B=y===L-1;return m&&B?"":m?g.firstButton:B?g.lastButton:g.middleButton};return o.jsx(Wt,j({role:"group",className:J(g.root,l),ref:a,ownerState:b},s,{children:o.jsx(X.Provider,{value:D,children:w.map((y,m)=>o.jsx(Z.Provider,{value:k(m),children:y},m))})}))});function P({title:t,subheader:e,height:a,type:r,unit:u,chart:l,...f}){const[x,v]=p.useState("day");ot();const n=l.colors,h=N({colors:n,xaxis:{categories:l.categories},yaxis:{labels:{formatter:s=>s.toFixed(2)}},legend:{show:!0},tooltip:{x:{format:"dd/MM/yy HH:mm"},y:{formatter:s=>`${s.toFixed(2)} ${u}`}},...l.options}),T=N({colors:n,xaxis:{categories:l.categories},yaxis:{labels:{formatter:s=>(s==null?void 0:s.toLocaleString())||""}},plotOptions:{bar:{dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:s=>s?`${s==null?void 0:s.toLocaleString()}`:"",offsetY:-20,style:{fontSize:"11px",colors:["#808080"]}},legend:{show:!0},tooltip:{x:{format:"dd/MM/yy HH:mm"},y:{formatter:s=>`${s.toFixed(2)} ${u}`}},...l.options}),d=N({colors:n,xaxis:{categories:l.categories},yaxis:{labels:{formatter:s=>s.toFixed(2)}},legend:{show:!0},tooltip:{x:{format:"dd/MM/yy HH:mm"},y:{formatter:s=>`${s.toFixed(2)} ${u}`}},chart:{animations:{enabled:!1,speed:800,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},...l.options}),i=(s,b)=>{console.log(b),v(b)};return o.jsxs(S,{...f,children:[o.jsxs(W,{display:"flex",sx:{flexWrap:{xs:"wrap",md:"nowrap"}},justifyContent:"space-between",alignItems:"center",gap:1,pt:2,children:[o.jsx(ut,{title:t,subheader:e,sx:{pt:0}}),o.jsxs(zt,{value:x,exclusive:!0,onChange:i,sx:{px:1.5,height:"35px"},children:[o.jsx(F,{value:"day",children:"วัน"}),o.jsx(F,{value:"month",children:"เดือน"}),o.jsx(F,{value:"year",children:"ปี"})]})]}),o.jsx(pt,{type:r,series:l.series,options:r==="line"?h:r==="bar"?T:r==="area"?d:{},...f,height:a})]})}function A({sx:t,post:e,unit:a,type:r,...u}){const l=a||(r==="electricity"?"kWh":"m³"),f=a||(r==="electricity"?"#FAF0E7":"#cee9fe"),x=a||(r==="electricity"?"#FF7400":"#0085ed");return o.jsx(S,{sx:t,...u,children:o.jsx(S,{sx:{height:"100%",px:1.5,bgcolor:f},children:o.jsxs(ft,{children:[o.jsxs(E,{variant:"subtitle1",color:"textSecondary",children:[r==="electricity"?"⚡":"💧"," ",e.title]}),o.jsxs(E,{variant:"caption",component:"div",color:"text.disabled",pb:1,pl:3,children:["ข้อมูลล่าสุด ",e.timestamp||"--/--/----, --:--:--"]}),o.jsxs(W,{gap:.1,display:"flex",alignItems:"center",justifyContent:"space-between",children:[o.jsxs(E,{variant:"h3",pl:3,color:x,children:[e.value||"------"," ",a||l]}),o.jsx(st,{title:"ดูข้อมูลเพิ่มเติม",children:o.jsx(rt,{children:o.jsx(mt,{src:"/assets/icons/iconify/info.svg",style:{width:"30px",height:"30px"}})})})]})]})})})}const M={wh:.001,kwh:1,mwh:1e3,gwh:1e6,twh:1e9};function U(t,e,a){const r=e.toLowerCase(),u=a.toLowerCase();if(!(r in M)||!(u in M))throw new Error("Invalid unit. Supported units are: Wh, kWh, MWh, GWh, TWh");return t*M[r]/M[u]}function wt(){const t=at();it(),nt();const[e,a]=p.useState(!0),[r,u]=p.useState(0),[l,f]=p.useState(),[x,v]=p.useState(),[n,h]=p.useState();p.useEffect(()=>{(async()=>{try{const i=["จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์"];if(r===0){const s=await gt(),b=s.meterData.map(g=>({name:g.meter_position,data:g.meterData.currentDateRange.map(C=>U(C.difference,g.meter_unit,"kwh"))}));f(s),h({title:"⚡ ข้อมูลการใช้ไฟฟ้า",subheader:`ข้อมูล ${s.dateStart} ถึง ${s.dateEnd}`,categories:i,series:b})}else if(r===1){const s=await xt(),b=s.meterData.map(g=>({name:g.meter_position,data:g.meterData.currentDateRange.map(C=>C.difference)}));v(s),h({title:"💧 ข้อมูลการใช้น้ำประปา",subheader:`ข้อมูล ${s.dateStart} ถึง ${s.dateEnd}`,categories:i,series:b})}a(!1)}catch(i){i.status===401||i.status===403?t("/login"):(dt.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",i))}})()},[e,t,r]);const T=(d,i)=>{u(i)};return o.jsxs(W,{sx:{p:3,pt:1},children:[o.jsxs(ht,{value:r,onChange:T,sx:{mb:3},children:[o.jsx(I,{label:"มิเตอร์ไฟฟ้า ⚡"}),o.jsx(I,{label:"มิเตอร์น้ำประปา 💧"})]}),r===0&&o.jsxs(W,{children:[o.jsx($,{container:!0,spacing:3,sx:{mb:4,minHeight:300},children:o.jsx($,{item:!0,xs:12,children:o.jsx(P,{type:"bar",title:n==null?void 0:n.title,subheader:n==null?void 0:n.subheader,unit:"kWh",chart:{categories:(n==null?void 0:n.categories)||[],series:(n==null?void 0:n.series)||[]},sx:{px:.5,py:1},height:325})})}),o.jsx($,{container:!0,spacing:3,sx:{mb:4,minHeight:135},children:l==null?void 0:l.meterData.map((d,i)=>{var s;return o.jsx($,{item:!0,xs:12,md:6,xl:4,children:o.jsx(A,{post:{title:d.meter_position,timestamp:d.meterData.latestData.timestamp,value:(s=U(d.meterData.latestData.value,d.meter_unit,"kwh"))==null?void 0:s.toLocaleString()},type:"electricity"})},d.energy_meter_id+i)})})]}),r===1&&o.jsxs(W,{children:[o.jsx($,{container:!0,spacing:3,sx:{mb:4,minHeight:300},children:o.jsx($,{item:!0,xs:12,children:o.jsx(P,{type:"bar",title:"💧 ข้อมูลการใช้น้ำประปา",subheader:"ไม่มีข้อมูลในช่วงนี้",unit:"m³",chart:{categories:(n==null?void 0:n.categories)||[],series:(n==null?void 0:n.series)||[]},sx:{px:.5,py:1},height:325})})}),o.jsx($,{container:!0,spacing:3,sx:{mb:4,minHeight:135},children:x==null?void 0:x.meterData.map((d,i)=>{var s;return o.jsx($,{item:!0,xs:12,md:6,xl:4,children:o.jsx(A,{post:{title:d.meter_position,timestamp:d.meterData.latestData.timestamp,value:(s=d.meterData.latestData.value)==null?void 0:s.toLocaleString()},type:"water"})},d.energy_meter_id+i)})})]})]})}function Pt(){return o.jsxs(o.Fragment,{children:[o.jsx(lt,{children:o.jsxs("title",{children:[" ",`การใช้พลังงาน - ${ct.appName}`]})}),o.jsx(wt,{})]})}export{Pt as default};
