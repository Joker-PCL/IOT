import{u as w,j as e,B as x,A as k,T as u,f as y,S as j,r as d,a as I,v as P,P as F,M as A,b as T,m as C,I as L,c as O,D as $,H as z}from"./index-DOqBKa96.js";import{C as B}from"./config-global-DGEDRhMa.js";import{C as E,S}from"./Card-DhZhQ55O.js";import{A as G,a as M}from"./Autocomplete-Byz_VlAy.js";import{T as N}from"./TextField-BSiIcRap.js";import{L as W}from"./loading_page-C-gxeEt4.js";import{C as H,D as R}from"./main-DnsE4DEd.js";import{G as X}from"./Grid2-y5Ol-IeI.js";function q({sx:a,post:t,...m}){const s=w(),h=n=>()=>{n.lot_number?s("/Details",{state:n}):S.fire({icon:"question",title:`เครื่อง ${n.machine}`,text:"ไม่พบข้อมูลการผลิต, ยังไม่มีข้อมูลการผลิตในวันนี้!",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"+ เพิ่มข้อมูล"}).then(v=>{v.isConfirmed&&s("/production/form",{state:{row:{machine:n.machine}}})})},c=n=>()=>{s("/machine-setting/form",{state:{post:{device_id:n.device_id,serial_number_1:n.serial_number_1,serial_number_2:n.serial_number_2,machine:n.machine,machine_img:n.machine_img,group_name:n.group_name}}})},g=e.jsx(x,{component:"img",alt:t.machine,src:t.machine_img?t.machine_img:"/assets/images/machine/default.png",sx:{top:0,width:1,height:1,objectFit:"cover",position:"absolute"}}),l=e.jsx(k,{alt:t.machine,src:t.group_img?t.group_img:"/assets/images/machine/default.png",sx:{left:24,zIndex:9,bottom:-24,position:"absolute"}}),p=e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`เลขที่ผลิต ${t.lot_number?t.lot_number:"XXXXXX"}`}),e.jsx(u,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`ชื่อยา ${t.product_name?t.product_name:"XXXXXX"}`}),e.jsx(u,{variant:"body2",component:"div",sx:{color:"grey"},children:`ขนาดการผลิต ${t.batch_size?t.batch_size.toLocaleString():"XXXXXX"}`}),e.jsxs(u,{variant:"body2",component:"div",sx:{mb:1,color:"grey"},children:[`เริ่มการผลิต ${t.start_product?y(t.start_product):"XXXXXX"}`,e.jsx("br",{}),`จบการผลิต ${t.finish_product?y(t.finish_product):"XXXXXX"}`]})]}),f=e.jsxs(x,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"start",children:[e.jsx(u,{variant:"body1",component:"div",onClick:h(t),sx:{fontSize:"18px",color:"cornflowerblue",textDecoration:"underline",fontWeight:"400",cursor:"pointer"},children:t.machine}),e.jsx(j,{onClick:c(t),width:20,height:20,src:t.device_status===void 0?"/assets/icons/iconify/line-md--downloading-loop.svg":t.device_status?"/assets/icons/iconify/wpf--online.svg":"/assets/icons/iconify/oui--offline.svg",sx:{color:t.device_status===void 0?"text.disabled":t.device_status?"#40BC14":"#E4080A"}})]}),i=e.jsx(u,{variant:"caption",component:"div",sx:{mb:1,color:"text.disabled"},children:t.connection?y(t.connection):"XXXXXX"}),o=e.jsxs(x,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",sx:{mt:3},children:[e.jsx(j,{onClick:c(t),width:35,height:35,src:"/assets/icons/iconify/solar--settings-bold-duotone.svg",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}}),e.jsx(x,{gap:1.5,display:"flex",flexWrap:"wrap",justifyContent:"space-between",sx:{color:"text.disabled"},children:[{number:t.mode_gram_count,unit:"Gram",color:"primary.main",icon:"skill-icons:unity-light"},{number:t.mode_pcs_count,unit:"Pcs",color:"secondary.main",icon:"material-symbols:scale"}].map((n,v)=>e.jsxs(x,{display:"flex",children:[e.jsx(u,{variant:"body1",sx:{mr:.5,color:n.color,fontWeight:"500"},children:n.unit}),e.jsx(u,{variant:"body1",sx:{fontWeight:"500"},children:n.number.toLocaleString()})]},v))})]}),r=e.jsx(j,{width:88,height:36,src:"/assets/icons/shape-avatar.svg",sx:{left:0,zIndex:9,bottom:-16,position:"absolute",color:"background.paper"}});return e.jsxs(E,{sx:a,...m,children:[e.jsxs(x,{sx:n=>({position:"relative",pt:"calc(100% * 3 / 4)"}),children:[r,l,g]}),e.jsxs(x,{sx:n=>({p:n.spacing(6,3,3,3)}),children:[p,f,i,o]})]})}function V({options:a,filterBy:t,onFilter:m,sx:s,...h}){var f;const[c,g]=d.useState(null),l=d.useCallback(i=>{g(i.currentTarget)},[]),p=d.useCallback(()=>{g(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(I,{disableRipple:!0,color:"inherit",onClick:l,endIcon:e.jsx(j,{width:30,height:30,src:c?"/assets/icons/iconify/eva--chevron-up-fill.svg":"/assets/icons/iconify/eva--chevron-down-fill.svg",sx:{ml:-1}}),sx:{bgcolor:i=>P(i.vars.palette.grey["500Channel"],.08),...s},...h,children:(f=a.find(i=>i.value===t))==null?void 0:f.label}),e.jsx(F,{open:!!c,anchorEl:c,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(A,{disablePadding:!0,sx:{p:.5,gap:.5,width:160,display:"flex",flexDirection:"column",[`& .${C.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${C.selected}`]:{bgcolor:"action.selected"}}},children:a.map(i=>e.jsx(T,{selected:i.value===t,onClick:()=>{m(i.value),p()},children:i.label},i.value))})})]})}function U({posts:a,onSearch:t,sx:m}){return e.jsx(G,{sx:{width:280},autoHighlight:!0,freeSolo:!0,onInputChange:t,popupIcon:null,slotProps:{paper:{sx:{width:320,[`& .${M.option}`]:{typography:"body2"},...m}}},options:a,getOptionLabel:s=>typeof s=="string"?s:s.machine,isOptionEqualToValue:(s,h)=>s.machine===h.machine,renderInput:s=>e.jsx(N,{...s,placeholder:"ค้นหาเครื่องจักร...",InputProps:{...s.InputProps,startAdornment:e.jsx(L,{position:"start",children:e.jsx(O,{children:e.jsx("path",{fill:"currentColor",d:"m20.71 19.29l-3.4-3.39A7.92 7.92 0 0 0 19 11a8 8 0 1 0-8 8a7.92 7.92 0 0 0 4.9-1.69l3.39 3.4a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42M5 11a6 6 0 1 1 6 6a6 6 0 0 1-6-6"})})})}})})}function J({inputData:a,filterName:t}){return a=a.map((s,h)=>[s,h]).map(s=>s[0]),t&&(a=a.filter(s=>s.machine.toLowerCase().indexOf(t.toLowerCase())!==-1)),a}function K(){const a=w(),[t,m]=d.useState(""),[s,h]=d.useState([]),[c,g]=d.useState(!0),[l,p]=d.useState([]);d.useEffect(()=>{(async()=>{try{const r=await R();g(!1),p(r),h([...new Set([...r.map(n=>n.group_name)])])}catch(r){r.status===401||r.status===403?a("/sign-in"):(S.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",r))}})()},[c,a]),d.useEffect(()=>{const o=setInterval(async()=>{try{const r=l.map(b=>b.ip_address),n=await H(r),v=l.map(b=>{const _=n.find(D=>D.ip_address===b.ip_address);return _?{...b,device_status:_.device_status}:b});p(v)}catch(r){console.error("Error checking device statuses:",r)}},5e3);return()=>clearInterval(o)},[l]);const f=J({inputData:l,filterName:t}),i=d.useCallback(o=>{m(o)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{isShowing:c}),e.jsxs($,{children:[e.jsxs(x,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(u,{variant:"h4",flexGrow:1,children:"Dashboard"}),e.jsx(I,{variant:"contained",color:"inherit",onClick:()=>{a("/machine-setting/form")},startIcon:e.jsx(j,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการเครื่องจักร"})]}),e.jsxs(x,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mb:5},children:[e.jsx(U,{posts:l,onSearch:(o,r)=>{m(r)}}),e.jsx(V,{filterBy:t,onFilter:i,options:[{value:"",label:"Groups..."},...s.map(o=>({value:o,label:o}))]})]}),e.jsx(X,{container:!0,spacing:3,children:c?"":(t?f:l).map((o,r)=>e.jsx(X,{xs:12,sm:6,md:4,xl:3,children:e.jsx(q,{post:o})},o.machine+r))})]})]})}function re(){return e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs("title",{children:[" ",`Dashboard - ${B.appName}`]})}),e.jsx(K,{})]})}export{re as default};
