import{J as $,Q as G,r as i,O as A,z as L,j as e,N as H,_ as I,C as U,G as W,T as v,R as X,u as Y,B as R,f as O,n as S,S as C,b as z,P as Q,M as J,c as E,m as F,l as q,I as K,a as V,D as Z,o as ee,H as te}from"./index-Bhw5Yxrc.js";import{C as se}from"./config-global-DGEDRhMa.js";import{S as D,C as oe}from"./Card-CHhQk-r8.js";import{T as _,a as x,R as k,b as ne,c as ie,d as re,e as ae,f as le,g as ce}from"./react-svg.esm-CjpHafUy.js";import{P as de,b as ue}from"./main-DqsJbxx5.js";import{D as he,g as xe,a as pe,b as ge,c as me}from"./DialogContent-Di-kcoYH.js";import{O as fe}from"./Select-B0IoYeGo.js";import{L as je}from"./loading_page-C058tvp2.js";import"./KeyboardArrowRight-9vUXOeld.js";function be(t){return $("MuiDialogContentText",t)}G("MuiDialogContentText",["root"]);const Ce=["children","className"],ve=t=>{const{classes:s}=t,r=W({root:["root"]},be,s);return I({},s,r)},Pe=H(v,{shouldForwardProp:t=>X(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),ye=i.forwardRef(function(s,o){const r=A({props:s,name:"MuiDialogContentText"}),{className:c}=r,a=L(r,Ce),n=ve(a);return e.jsx(Pe,I({component:"p",variant:"body1",color:"text.secondary",ref:o,ownerState:a,className:U(n.root,c)},r,{classes:n}))}),we=["className","id"],Te=t=>{const{classes:s}=t;return W({root:["root"]},xe,s)},Se=H(v,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,s)=>s.root})({padding:"16px 24px",flex:"0 0 auto"}),De=i.forwardRef(function(s,o){const r=A({props:s,name:"MuiDialogTitle"}),{className:c,id:a}=r,n=L(r,we),d=r,p=Te(d),{titleId:f=a}=i.useContext(he);return e.jsx(Se,I({component:"h2",className:U(p.root,c),ownerState:d,ref:o,variant:"h6",id:a??f},n))});function Re({row:t,selected:s,eventsRows:o,onEventsRows:r,onSelectRow:c}){const a=Y(),[n,d]=i.useState(null),[p,f]=i.useState("paper"),[j,b]=i.useState(!1),P=i.useCallback(u=>{d(u.currentTarget)},[]),l=i.useCallback(()=>{d(null)},[]),g=u=>()=>{b(!0),f(u)},y=()=>{b(!1)},h=u=>()=>{const{machine:N,start_product:M,finish_product:T}=u;N&&M&&T&&(console.log("Open Detail:",u),a("/Details",{state:u}))},m=u=>{D.fire({title:"ยืนยันการลบรายการ",text:`ชื่อยา: ${u.product_name} เลขที่ผลิต: ${u.lot_number}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ยืนยันการลบ !",cancelButtonText:"ยกเลิก"}).then(N=>{N.isConfirmed&&(async()=>{try{const T=await de(u);r(!o),D.fire({icon:"success",title:"ดำเนินการเรียบร้อยแล้ว",text:"บันทึกรายการผลิตเรียบร้อยแล้ว",showConfirmButton:!1,timer:2e3})}catch(T){console.error("Error fetching data:",T),D.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!, ลองไหม่อีกครั้ง",showCancelButton:!0,cancelButtonText:"ปิด"})}})()})},w=i.useRef(null);return i.useEffect(()=>{if(j){const{current:u}=w;u!==null&&u.focus()}},[j]),e.jsxs(e.Fragment,{children:[e.jsxs(_,{hover:!0,selected:s,style:{verticalAlign:"middle"},children:[e.jsx(x,{component:"th",scope:"row",children:e.jsxs(R,{gap:1,display:"flex",alignItems:"center",children:[e.jsx(k,{src:"/assets/icons/iconify/overtime.svg",style:{width:"40px",height:"40px"}}),O(t.timestamp)]})}),e.jsx(x,{children:t.lot_number}),e.jsx(x,{children:t.product_name}),e.jsx(x,{children:t.batch_size?t.batch_size.toLocaleString():"X,XXX"}),e.jsx(x,{children:t.machine}),e.jsx(x,{children:O(t.start_product,"DD/MM/YYYY, HH:mm")}),e.jsx(x,{children:O(t.finish_product,"DD/MM/YYYY, HH:mm")}),e.jsx(x,{align:"center",children:e.jsx(S,{onClick:g("paper"),disabled:!t.notes,children:e.jsx(k,{src:t.notes?"/assets/icons/iconify/note.svg":"/assets/icons/iconify/empty-note.svg",style:{width:"30px",height:"30px"}})})}),e.jsx(x,{align:"center",children:e.jsx(S,{onClick:h(t),children:e.jsx(k,{src:"/assets/icons/iconify/info.svg",style:{width:"30px",height:"30px"}})})}),e.jsx(x,{align:"center",children:e.jsx(S,{onClick:P,children:e.jsx(C,{src:"/assets/icons/iconify/menu.svg",width:"25px",height:"25px"})})})]}),e.jsxs(pe,{fullWidth:!0,maxWidth:"sm",open:j,onClose:y,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[e.jsx(De,{id:"scroll-dialog-title",children:"รายละเอียดเพิ่มเติม"}),e.jsx(ge,{dividers:p==="paper",sx:{minHeight:250},children:e.jsx(ye,{id:"scroll-dialog-description",ref:w,tabIndex:-1,children:t.notes?t.notes:"# ไม่มีหมายเหตุ"})}),e.jsx(me,{children:e.jsx(z,{onClick:y,variant:"contained",color:"error",children:"ปิด"})})]}),e.jsx(Q,{open:!!n,anchorEl:n,onClose:l,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(J,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${F.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${F.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(E,{onClick:()=>{l(),t&&a("/production/form",{state:{row:t}})},children:[e.jsx(C,{src:"/assets/icons/iconify/edit.svg",width:"20px",height:"20px"}),"แก้ไข"]}),e.jsxs(E,{onClick:()=>{l(),m(t)},sx:{color:"error.main"},children:[e.jsx(C,{src:"/assets/icons/iconify/delete.svg",width:"20px",height:"20px"}),"ลบ"]})]})})]})}function _e({searchQuery:t,...s}){return e.jsx(_,{...s,children:e.jsx(x,{align:"center",colSpan:7,children:e.jsxs(R,{sx:{py:15,textAlign:"center"},children:[e.jsx(v,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(v,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Ne={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Oe(t,s,o){return t?Math.max(0,(1+t)*s-o):0}function B(t,s,o){return s[o]<t[o]?-1:s[o]>t[o]?1:0}function ke(t,s){return t==="desc"?(o,r)=>-B(o,r,s):(o,r)=>B(o,r,s)}function Ie({inputData:t,comparator:s,filterName:o,order:r}){const c=t.map((a,n)=>[a,n]);return c.sort((a,n)=>{const d=s(a[0],n[0]);return d!==0?d:a[1]-n[1]}),t=c.map(a=>a[0]),o&&(t=t.filter(a=>Object.values(a).some(n=>String(n).toLowerCase().includes(o.toLowerCase())))),t}function Me({order:t,onSort:s,orderBy:o,rowCount:r,headLabel:c,numSelected:a}){return e.jsx(ne,{children:e.jsx(_,{style:{verticalAlign:"top"},children:c.map(n=>e.jsx(x,{align:n.align||"left",sortDirection:o===n.id?t:!1,sx:{width:n.width,minWidth:n.minWidth},children:e.jsxs(ie,{hideSortIcon:!0,active:o===n.id,direction:o===n.id?t:"asc",onClick:()=>s(n.id),children:[n.label,o===n.id?e.jsx(R,{sx:{...Ne},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},n.id))})})}function Ee({numSelected:t,filterName:s,onFilterName:o}){return e.jsxs(q,{sx:{height:96,display:"flex",justifyContent:"space-between",p:r=>r.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(v,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(fe,{fullWidth:!0,value:s,onChange:o,placeholder:"ค้นหาข้อมูลในตาราง...",startAdornment:e.jsx(K,{position:"start",children:e.jsx(C,{src:"/assets/icons/iconify/filter.svg",width:"20px",height:"20px",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),e.jsx(V,{title:"Filter list",children:e.jsx(S,{children:e.jsx(C,{src:"/assets/icons/iconify/filter.svg",width:"20px",height:"20px",sx:{color:"text.disabled"}})})})]})}function Fe({emptyRows:t,height:s,sx:o,...r}){return t?e.jsx(_,{sx:{...s&&{height:s*t},...o},...r,children:e.jsx(x,{colSpan:9})}):null}function Be(){const t=Y(),s=Ae(),[o,r]=i.useState(!0),[c,a]=i.useState(!1),[n,d]=i.useState([]),[p,f]=i.useState("");i.useEffect(()=>{(async()=>{try{const g=await ue();r(!1),d(g),console.log(g)}catch(g){g.status===401||g.status===403?t("/login"):(D.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",g))}})()},[c,t]);const j=()=>()=>{t("/production/form")},b=Ie({inputData:n,comparator:ke(s.order,s.orderBy),filterName:p,order:"asc"}),P=!b.length&&!!p;return e.jsxs(e.Fragment,{children:[e.jsx(je,{isShowing:o}),e.jsxs(Z,{children:[e.jsxs(R,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(v,{variant:"h4",flexGrow:1,children:"รายการผลิต"}),e.jsx(z,{variant:"contained",color:"inherit",onClick:j(),startIcon:e.jsx(C,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการ"})]}),e.jsxs(oe,{children:[e.jsx(Ee,{numSelected:s.selected.length,filterName:p,onFilterName:l=>{f(l.target.value),s.onResetPage()}}),e.jsx(ee,{children:e.jsx(re,{sx:{overflow:"unset"},children:e.jsxs(ae,{sx:{minWidth:1100},children:[e.jsx(Me,{order:s.order,orderBy:s.orderBy,rowCount:n.length,numSelected:s.selected.length,onSort:s.onSort,headLabel:[{id:"timestamp",label:"Timestamp"},{id:"lot_number",label:"เลขที่ผลิต"},{id:"product_names",label:"รายการผลิต"},{id:"batch_size",label:"ขนาดผลิต"},{id:"machine",label:"เครื่องจักร"},{id:"start_product",label:"วันที่เริ่มการผลิต"},{id:"finish_product",label:"วันที่จบการผลิต"},{id:"note",label:"Note",align:"center"},{id:"info",label:"ข้อมูล",align:"center"},{id:"edit",label:"แก้ไข",align:"center"}]}),e.jsxs(le,{children:[b.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(l=>e.jsx(Re,{row:l,eventsRows:c,onEventsRows:a,selected:s.selected.includes(l.production_id),onSelectRow:()=>s.onSelectRow(l.production_id)},l.production_id)),e.jsx(Fe,{height:68,emptyRows:Oe(s.page,s.rowsPerPage,n.length)}),P&&e.jsx(_e,{searchQuery:p})]})]})})}),e.jsx(ce,{component:"div",page:s.page,count:n.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})]})]})]})}function Ae(){const[t,s]=i.useState(0),[o,r]=i.useState("name"),[c,a]=i.useState(5),[n,d]=i.useState([]),[p,f]=i.useState("asc"),j=i.useCallback(h=>{f(o===h&&p==="asc"?"desc":"asc"),r(h)},[p,o]),b=i.useCallback((h,m)=>{if(h){d(m);return}d([])},[]),P=i.useCallback(h=>{const m=n.includes(h)?n.filter(w=>w!==h):[...n,h];d(m)},[n]),l=i.useCallback(()=>{s(0)},[]),g=i.useCallback((h,m)=>{s(m)},[]),y=i.useCallback(h=>{a(parseInt(h.target.value,10)),l()},[l]);return{page:t,order:p,onSort:j,orderBy:o,selected:n,rowsPerPage:c,onSelectRow:P,onResetPage:l,onChangePage:g,onSelectAllRows:b,onChangeRowsPerPage:y}}function Qe(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",`รายการผลิต - ${se.appName}`]})}),e.jsx(Be,{})]})}export{Qe as default};
