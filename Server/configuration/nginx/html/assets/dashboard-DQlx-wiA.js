import{u as w,j as e,B as u,A as k,T as m,f as j,S as I,r as l,a as S,v as F,P as L,M as O,b as T,m as _,I as A,c as $,D as z,H as B}from"./index-BW6UL1e8.js";import{C as E}from"./config-global-DGEDRhMa.js";import{C as M,S as D}from"./Card-BqeI6cof.js";import{I as y}from"./flag-icon-BGoKx03L.js";import{A as G,a as W}from"./Autocomplete-B7c6d971.js";import{T as N}from"./TextField-DMUOBYT1.js";import{L as H}from"./loading_page-BW9yVIES.js";import{C as R,D as q}from"./main-BUUIBYx6.js";import{G as C}from"./Grid2-CAE2XYOz.js";function V({sx:r,post:t,...h}){const n=w(),d=a=>()=>{a.lot_number?n("/Details",{state:a}):D.fire({icon:"question",title:`เครื่อง ${a.machine}`,text:"ไม่พบข้อมูลการผลิต, ยังไม่มีข้อมูลการผลิตในวันนี้!",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"+ เพิ่มข้อมูล"}).then(b=>{b.isConfirmed&&n("/production/form")})},x=a=>()=>{n("/machine-setting/form",{state:{post:{device_id:a.device_id,serial_number:a.serial_number,machine:a.machine,machine_img:a.machine_img,group_name:a.group_name}}})},g=e.jsx(u,{component:"img",alt:t.machine,src:t.machine_img?t.machine_img:"/assets/images/machine/default.png",sx:{top:0,width:1,height:1,objectFit:"cover",position:"absolute"}}),i=e.jsx(k,{alt:t.machine,src:t.group_img?t.group_img:"/assets/images/machine/default.png",sx:{left:24,zIndex:9,bottom:-24,position:"absolute"}}),p=e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`เลขที่ผลิต ${t.lot_number?t.lot_number:"XXXXXX"}`}),e.jsx(m,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`ชื่อยา ${t.product_name?t.product_name:"XXXXXX"}`}),e.jsx(m,{variant:"body2",component:"div",sx:{color:"grey"},children:`ขนาดการผลิต ${t.batch_size?t.batch_size.toLocaleString():"XXXXXX"}`}),e.jsxs(m,{variant:"body2",component:"div",sx:{mb:1,color:"grey"},children:[`เริ่มการผลิต ${t.start_product?j(t.start_product):"XXXXXX"}`,e.jsx("br",{}),`จบการผลิต ${t.finish_product?j(t.finish_product):"XXXXXX"}`]})]}),f=e.jsxs(u,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"start",children:[e.jsx(m,{variant:"body1",component:"div",onClick:d(t),sx:{fontSize:"18px",color:"cornflowerblue",textDecoration:"underline",fontWeight:"400",cursor:"pointer"},children:t.machine}),e.jsx(y,{width:25,icon:t.device_status===void 0?"line-md:downloading-loop":t.device_status?"wpf:online":"carbon:cloud-offline",sx:{color:t.device_status===void 0?"text.disabled":t.device_status?"green":"red"}})]}),o=e.jsx(m,{variant:"caption",component:"div",sx:{mb:1,color:"text.disabled"},children:t.connection?j(t.connection):"XXXXXX"}),c=e.jsxs(u,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",sx:{mt:3},children:[e.jsx(y,{onClick:x(t),className:"machine-setting-icon",width:35,icon:"line-md:cog",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}}),e.jsx(u,{gap:1.5,display:"flex",flexWrap:"wrap",justifyContent:"space-between",sx:{color:"text.disabled"},children:[{number:t.mode_gram_count,unit:"Gram",color:"primary.main",icon:"skill-icons:unity-light"},{number:t.mode_pcs_count,unit:"Pcs",color:"secondary.main",icon:"material-symbols:scale"}].map((a,b)=>e.jsxs(u,{display:"flex",children:[e.jsx(m,{variant:"body1",sx:{mr:.5,color:a.color,fontWeight:"500"},children:a.unit}),e.jsx(m,{variant:"body1",sx:{fontWeight:"500"},children:a.number.toLocaleString()})]},b))})]}),s=e.jsx(I,{width:88,height:36,src:"/assets/icons/shape-avatar.svg",sx:{left:0,zIndex:9,bottom:-16,position:"absolute",color:"background.paper"}});return e.jsxs(M,{sx:r,...h,children:[e.jsxs(u,{sx:a=>({position:"relative",pt:"calc(100% * 3 / 4)"}),children:[s,i,g]}),e.jsxs(u,{sx:a=>({p:a.spacing(6,3,3,3)}),children:[p,f,o,c]})]})}function U({options:r,sortBy:t,onSort:h,sx:n,...d}){var f;const[x,g]=l.useState(null),i=l.useCallback(o=>{g(o.currentTarget)},[]),p=l.useCallback(()=>{g(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(S,{disableRipple:!0,color:"inherit",onClick:i,endIcon:e.jsx(y,{icon:x?"eva:chevron-up-fill":"eva:chevron-down-fill",sx:{ml:-.5}}),sx:{bgcolor:o=>F(o.vars.palette.grey["500Channel"],.08),...n},...d,children:(f=r.find(o=>o.value===t))==null?void 0:f.label}),e.jsx(L,{open:!!x,anchorEl:x,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(O,{disablePadding:!0,sx:{p:.5,gap:.5,width:160,display:"flex",flexDirection:"column",[`& .${_.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${_.selected}`]:{bgcolor:"action.selected"}}},children:r.map(o=>e.jsx(T,{selected:o.value===t,onClick:()=>{h(o.value),p()},children:o.label},o.value))})})]})}function J({posts:r,onSearch:t,sx:h}){return e.jsx(G,{sx:{width:280},autoHighlight:!0,freeSolo:!0,onInputChange:t,popupIcon:null,slotProps:{paper:{sx:{width:320,[`& .${W.option}`]:{typography:"body2"},...h}}},options:r,getOptionLabel:n=>typeof n=="string"?n:n.machine,isOptionEqualToValue:(n,d)=>n.serial_number===d.serial_number,renderInput:n=>e.jsx(N,{...n,placeholder:"ค้นหาเครื่องจักร...",InputProps:{...n.InputProps,startAdornment:e.jsx(A,{position:"start",children:e.jsx($,{children:e.jsx("path",{fill:"currentColor",d:"m20.71 19.29l-3.4-3.39A7.92 7.92 0 0 0 19 11a8 8 0 1 0-8 8a7.92 7.92 0 0 0 4.9-1.69l3.39 3.4a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42M5 11a6 6 0 1 1 6 6a6 6 0 0 1-6-6"})})})}})})}function K({inputData:r,filterName:t}){return r=r.map((n,d)=>[n,d]).map(n=>n[0]),t&&(r=r.filter(n=>n.machine.toLowerCase().indexOf(t.toLowerCase())!==-1)),r}function Q(){const r=w(),[t,h]=l.useState("latest"),[n,d]=l.useState(""),[x,g]=l.useState(!0),[i,p]=l.useState([]);l.useEffect(()=>{(async()=>{try{const s=await q();g(!1),p(s),console.log(s)}catch(s){s.status===401||s.status===403?r("/sign-in"):(D.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",s))}})()},[r]),l.useEffect(()=>{const c=setInterval(async()=>{try{const s=i.map(v=>v.ip_address),a=await R(s),b=i.map(v=>{const X=a.find(P=>P.ip_address===v.ip_address);return X?{...v,device_status:X.device_status}:v});p(b)}catch(s){console.error("Error checking device statuses:",s)}},5e3);return()=>clearInterval(c)},[i]);const f=K({inputData:i,filterName:n}),o=l.useCallback(c=>{h(c)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(H,{isShowing:x}),e.jsxs(z,{children:[e.jsxs(u,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(m,{variant:"h4",flexGrow:1,children:"Dashboard"}),e.jsx(S,{variant:"contained",color:"inherit",onClick:()=>{r("/machine-setting/form")},startIcon:e.jsx(I,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการเครื่องจักร"})]}),e.jsxs(u,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mb:5},children:[e.jsx(J,{posts:i,onSearch:(c,s)=>{d(s)}}),e.jsx(U,{sortBy:t,onSort:o,options:[{value:"latest",label:"Latest"},{value:"popular",label:"Popular"},{value:"oldest",label:"Oldest"}]})]}),e.jsx(C,{container:!0,spacing:3,children:x?"":(n?f:i).map((c,s)=>e.jsx(C,{xs:12,sm:6,md:4,xl:3,children:e.jsx(V,{post:c})},c.serial_number))})]})]})}function ie(){return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs("title",{children:[" ",`Dashboard - ${E.appName}`]})}),e.jsx(Q,{})]})}export{ie as default};
