import{u as F,r as d,j as e,B as a,A as $,T as c,f as X,S as g,L as z,a as I,b as T,v as B,P as G,M as H,c as N,m as L,I as R,d as q,D as V,H as U}from"./index-BYYLQHAw.js";import{C as J}from"./config-global-DGEDRhMa.js";import{S as M}from"./sweetalert2.esm.all-B0Dix5B2.js";import{C as K}from"./Card-DpruG_lM.js";import{A as Q,a as Y}from"./Autocomplete-BoW6qwtk.js";import{T as Z}from"./TextField-DJMcUjaN.js";import{L as ee}from"./loading_page-DT0WRG1P.js";import{C as te,D as ne}from"./main-DdPlhnOk.js";import{G as k}from"./Grid2-B2IUJL7b.js";import"./link_api-Zg2sN_XP.js";function se({sx:r,post:t,...h}){const n=F(),[u,x]=d.useState(0),[b,m]=d.useState("");d.useEffect(()=>{const s=new Date(t.start_product),O=new Date().getTime()-s.getTime(),W=Math.floor(O/1e3),S=Math.floor(W/60),D=Math.floor(S/60),P=S%60;m(`${D>=0?D:"XX"} ชั่วโมง ${P>=0?P:"XX"} นาที`);const A=((t==null?void 0:t.mode_pcs_count)>(t==null?void 0:t.mode_gram_count)?t.mode_pcs_count:t.mode_gram_count)/t.batch_size*100;x(A)},[t]);const f=s=>()=>{s.lot_number?n("/Details",{state:s}):M.fire({icon:"question",title:`เครื่อง ${s.machine}`,text:"ไม่พบข้อมูลการผลิต, ยังไม่มีข้อมูลการผลิตในวันนี้!",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"+ เพิ่มข้อมูล"}).then(_=>{_.isConfirmed&&n("/production/form",{state:{row:{machine:s.machine}}})})},j=s=>()=>{n("/machine-setting/form",{state:{post:{device_id:s.device_id,serial_number_1:s.serial_number_1,serial_number_2:s.serial_number_2,machine:s.machine,machine_img:s.machine_img,group_name:s.group_name}}})},o=s=>()=>{n("/performance",{state:{row:{machine:s.machine}}})},l=e.jsx(a,{component:"img",alt:t.machine,src:t.machine_img?t.machine_img:"/assets/images/machine/default.png",sx:{top:0,width:1,height:1,objectFit:"cover",position:"absolute"}}),i=e.jsx(g,{width:88,height:36,src:"/assets/icons/shape-avatar.svg",sx:{left:0,zIndex:9,bottom:-16,position:"absolute",color:"background.paper"}}),v=e.jsx($,{alt:t.machine,src:t.group_img?t.group_img:"/assets/images/machine/default.png",sx:{left:24,zIndex:9,bottom:-24,position:"absolute"}}),w=e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`เลขที่ผลิต ${t.lot_number?t.lot_number:"XXXXXX"}`}),e.jsx(c,{variant:"body1",component:"div",sx:{color:"darkcyan"},children:`ชื่อยา ${t.product_name?t.product_name:"XXXXXX"}`}),e.jsxs(c,{variant:"body2",component:"div",sx:{mb:1,color:"grey"},children:[`เริ่มการผลิต ${t.start_product?X(t.start_product):"XXXXXX"}`,e.jsx("br",{}),`จบการผลิต ${t.finish_product?X(t.finish_product):"XXXXXX"}`]})]}),p=e.jsxs(a,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",children:[e.jsx(c,{variant:"body1",component:"div",sx:{fontSize:"18px",color:"cornflowerblue",textDecoration:"underline",fontWeight:"400"},children:t.machine}),e.jsxs(a,{gap:.1,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(g,{width:15,height:15,src:"/assets/icons/iconify/si-clock-duotone.svg",sx:{mb:.3,mr:.3,color:"#40BC14"}}),e.jsx(c,{variant:"body2",component:"div",sx:{color:"text.disabled"},children:b})]})]}),y=e.jsxs(a,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",children:[e.jsx(c,{variant:"caption",component:"div",sx:{color:"text.disabled"},children:t.connection?X(t.connection):"XXXXXX"}),e.jsxs(a,{gap:.1,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(g,{width:15,height:15,src:t.device_status===void 0?"/assets/icons/iconify/line-md--downloading-loop.svg":"/assets/icons/iconify/ic-round-lens.svg",sx:{mb:.1,color:t.device_status===void 0?"text.disabled":t.device_status?"#40BC14":"#E4080A"}}),e.jsx(c,{variant:"body2",component:"div",sx:{color:"text.disabled"},children:t.device_status===void 0?"Loading...":t.device_status?"กำลังทำงาน":"หยุดทำงาน"})]})]}),C=e.jsxs(e.Fragment,{children:[e.jsxs(a,{gap:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",sx:{mt:1,color:"text.disabled"},children:[e.jsx(c,{variant:"body2",sx:{mr:.5},children:"การผลิต"}),e.jsxs(c,{variant:"body2",children:[(t==null?void 0:t.mode_pcs_count)>(t==null?void 0:t.mode_gram_count)?t.mode_pcs_count.toLocaleString():t.mode_gram_count.toLocaleString(),"/",t.batch_size>0?t.batch_size.toLocaleString():"X,XXX"]})]}),e.jsx(a,{sx:{width:"100%"},children:e.jsx(z,{variant:"determinate",color:"success",sx:{height:15,borderRadius:1},value:u})})]});a,a,[{number:t.mode_gram_count,unit:"Gram",color:"primary.main",icon:"skill-icons:unity-light"},{number:t.mode_pcs_count,unit:"Pcs",color:"secondary.main",icon:"material-symbols:scale"}].map((s,_)=>e.jsxs(a,{display:"flex",children:[e.jsx(c,{variant:"body1",sx:{mr:.5,color:s.color,fontWeight:"500"},children:s.unit}),e.jsx(c,{variant:"body1",sx:{fontWeight:"500"},children:s.number.toLocaleString()})]},_));const E=e.jsx(e.Fragment,{children:e.jsxs(a,{gap:1.5,display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",sx:{mt:2},children:[e.jsxs(a,{gap:1,display:"flex",flexWrap:"wrap",alignItems:"center",children:[e.jsx(I,{title:"ตั้งค่าเครื่องจักร",children:e.jsx(g,{onClick:j(t),width:30,height:30,src:"/assets/icons/iconify/solar--settings-bold-duotone.svg",sx:{cursor:"pointer",color:"text.disabled"}})}),e.jsx(I,{title:"ข้อมูลการผลิต",children:e.jsx(g,{onClick:f(t),width:30,height:30,src:"/assets/icons/iconify/fluent--clipboard-text-edit-48-filled.svg",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}})}),e.jsx(I,{title:"ประสิทธิภาพการผลิต",children:e.jsx(g,{onClick:o(t),width:30,height:30,src:"/assets/icons/navbar/ic-performance.svg",sx:{cursor:"pointer",mr:.5,color:"text.disabled"}})})]}),e.jsxs(a,{display:"flex",children:[e.jsx(c,{variant:"body1",sx:{mr:.5,color:"primary.main",fontWeight:"500"},children:"SPEED"}),e.jsx(c,{variant:"body1",sx:{fontWeight:"500",color:"#868686"},children:"XX.X/XX"})]})]})});return e.jsxs(K,{sx:r,...h,children:[e.jsxs(a,{sx:s=>({position:"relative",pt:"calc(100% * 3 / 4)"}),children:[i,v,l]}),e.jsxs(a,{sx:s=>({p:s.spacing(6,3,3,3)}),children:[w,p,y,C,E]})]})}function ae({options:r,filterBy:t,onFilter:h,sx:n,...u}){var j;const[x,b]=d.useState(null),m=d.useCallback(o=>{b(o.currentTarget)},[]),f=d.useCallback(()=>{b(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(T,{disableRipple:!0,color:"inherit",onClick:m,endIcon:e.jsx(g,{width:30,height:30,src:x?"/assets/icons/iconify/eva--chevron-up-fill.svg":"/assets/icons/iconify/eva--chevron-down-fill.svg",sx:{ml:-1}}),sx:{bgcolor:o=>B(o.vars.palette.grey["500Channel"],.08),...n},...u,children:(j=r.find(o=>o.value===t))==null?void 0:j.label}),e.jsx(G,{open:!!x,anchorEl:x,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(H,{disablePadding:!0,sx:{p:.5,gap:.5,width:160,display:"flex",flexDirection:"column",[`& .${L.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${L.selected}`]:{bgcolor:"action.selected"}}},children:r.map(o=>e.jsx(N,{selected:o.value===t,onClick:()=>{h(o.value),f()},children:o.label},o.value))})})]})}function re({posts:r,onSearch:t,sx:h}){return e.jsx(Q,{sx:{width:280},autoHighlight:!0,freeSolo:!0,onInputChange:t,popupIcon:null,slotProps:{paper:{sx:{width:320,[`& .${Y.option}`]:{typography:"body2"},...h}}},options:r,getOptionLabel:n=>typeof n=="string"?n:n.machine,isOptionEqualToValue:(n,u)=>n.machine===u.machine,renderInput:n=>e.jsx(Z,{...n,placeholder:"ค้นหาเครื่องจักร...",InputProps:{...n.InputProps,startAdornment:e.jsx(R,{position:"start",children:e.jsx(q,{children:e.jsx("path",{fill:"currentColor",d:"m20.71 19.29l-3.4-3.39A7.92 7.92 0 0 0 19 11a8 8 0 1 0-8 8a7.92 7.92 0 0 0 4.9-1.69l3.39 3.4a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42M5 11a6 6 0 1 1 6 6a6 6 0 0 1-6-6"})})})}})})}function ie({inputData:r,filterName:t}){return r=r.map((n,u)=>[n,u]).map(n=>n[0]),t&&(r=r.filter(n=>n.machine.toLowerCase().indexOf(t.toLowerCase())!==-1||n.group_name.toLowerCase().indexOf(t.toLowerCase())!==-1)),r}function oe(){const r=F(),[t,h]=d.useState(""),[n,u]=d.useState([]),[x,b]=d.useState(!0),[m,f]=d.useState([]);d.useEffect(()=>{(async()=>{try{const i=await ne();b(!1),f(i),u([...new Set([...i.map(v=>v.group_name)])])}catch(i){i.status===401||i.status===403?r("/login"):(M.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!",showConfirmButton:!1}),console.error("Error fetching data:",i))}})()},[x,r]),d.useEffect(()=>{const l=setInterval(async()=>{try{const i=m.map(p=>p.ip_address),v=await te(i),w=m.map(p=>{const y=v.find(C=>C.ip_address===p.ip_address);return y?{...p,device_status:y.device_status}:p});f(w)}catch(i){console.error("Error checking device statuses:",i)}},5e3);return()=>clearInterval(l)},[m]);const j=ie({inputData:m,filterName:t}),o=d.useCallback(l=>{h(l)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{isShowing:x}),e.jsxs(V,{children:[e.jsxs(a,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(c,{variant:"h4",flexGrow:1,children:"Dashboard"}),e.jsx(T,{variant:"contained",color:"inherit",onClick:()=>{r("/machine-setting/form")},startIcon:e.jsx(g,{src:"/assets/icons/iconify/add.svg",width:"20px",height:"20px"}),children:"เพิ่มรายการเครื่องจักร"})]}),e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mb:5},children:[e.jsx(re,{posts:m,onSearch:(l,i)=>{h(i)}}),e.jsx(ae,{filterBy:t,onFilter:o,options:[{value:"",label:"Groups..."},...n.map(l=>({value:l,label:l}))]})]}),e.jsx(k,{container:!0,spacing:3,children:x?"":(t?j:m).map((l,i)=>e.jsx(k,{xs:12,sm:6,md:4,xl:3,children:e.jsx(se,{post:l})},l.machine+i))})]})]})}function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs("title",{children:[" ",`Dashboard - ${J.appName}`]})}),e.jsx(oe,{})]})}export{ve as default};
